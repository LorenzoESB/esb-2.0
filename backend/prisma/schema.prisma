generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  schemas  = ["simuladores_rankings"]
}

enum SimulatorType {
  AMORTIZACAO
  APOSENTADORIA
  COMBUSTIVEL
  CONTAS_DIGITAIS
  EMPRESTIMO
  FINANCIAMENTO_IMOVEL
  FINANCIAMENTO_VEICULOS
  INVESTIMENTOS
  JUROS_COMPOSTOS
  RENDA_FIXA
  COMPARADOR_ASSINATURA_CARRO
  TAXA_MAQUININHA
  COMPARADOR_MAQUININHA

  @@schema("simuladores_rankings")
}

model Simulation {
  id            Int           @id @default(autoincrement())
  createdAt     DateTime      @default(now())
  simulatorType SimulatorType
  nome          String
  email         String
  inputData     Json
  outputData    Json

  @@map("simulations")
  @@schema("simuladores_rankings")
}

model AdminUser {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String    @map("password_hash")
  name         String
  role         String    @default("maintainer")
  isActive     Boolean   @default(true) @map("is_active")
  createdAt    DateTime  @default(now()) @map("created_at")
  lastLogin    DateTime? @map("last_login")
  updatedAt    DateTime  @default(now()) @updatedAt @map("updated_at")

  @@index([email])
  @@index([role])
  @@map("admin_users")
  @@schema("simuladores_rankings")
}

model RankingMetadata {
  id             String   @id @default(uuid())
  rankingId      String   @unique @map("ranking_id")
  title          String?
  description    String?
  parameters     Json?    @default("{}")
  dataSources    Json?    @default("{}") @map("data_sources")
  overrideLegacy Boolean  @default(false) @map("override_legacy")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at")

  @@index([rankingId])
  @@map("ranking_metadata")
  @@schema("simuladores_rankings")
}

model SimulatorMetadata {
  id            String   @id @default(uuid())
  simulatorId   String   @unique @map("simulator_id")
  title         String?
  description   String?
  category      String?
  configuration Json?    @default("{}")
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")

  @@index([simulatorId])
  @@index([category])
  @@map("simulator_metadata")
  @@schema("simuladores_rankings")
}

model AnalyticsEvent {
  id         String   @id @default(uuid())
  pagePath   String   @map("page_path")
  eventType  String   @map("event_type")
  metadata   Json?    @default("{}")
  occurredAt DateTime @default(now()) @map("occurred_at")

  @@index([pagePath])
  @@index([eventType])
  @@index([occurredAt(sort: Desc)])
  @@map("analytics_events")
  @@schema("simuladores_rankings")
}

model DataHealthCheck {
  id         String   @id @default(uuid())
  checkType  String   @map("check_type")
  entityType String   @map("entity_type")
  entityId   String   @map("entity_id")
  status     String
  issues     Json?    @default("[]")
  checkedAt  DateTime @default(now()) @map("checked_at")

  @@index([entityType, entityId])
  @@index([status])
  @@index([checkedAt(sort: Desc)])
  @@map("data_health_checks")
  @@schema("simuladores_rankings")
}
